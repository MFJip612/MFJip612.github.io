# CSS 属性计算过程

你知道 CSS 属性是如何一步步被计算出来的吗？
很多同学虽然熟悉 CSS 属性，比如：

```css
p {
    color: red;
}
```

这里的 `color` 就是一个 CSS 属性。但对于其背后的完整计算过程，可能并不清晰。这篇文章将帮你彻底搞懂这个过程。
先思考一个问题：对于下面这段简单的 HTML：

```html
<body>
    <h1>这是一个h1标题</h1>
</body>
```

我们并未给 `h1` 设置任何样式，但它依然有默认的字体大小和颜色。那么，这个 `h1` 元素到底拥有哪些 CSS 属性呢？
答案是：**该元素拥有所有 CSS 属性。** 你可以通过浏览器开发者工具的【元素】面板，切换到【计算样式】并勾选【全部显示】来验证。你会发现 `h1` 上每个 CSS 属性都有对应的值。
![查看所有CSS属性](https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2022-08-13-061516.png)
换句话说，**每个 HTML 元素都有一套完整的 CSS 样式**。我们平时写的 CSS 通常只是覆盖了需要更改的部分，这容易造成误解，以为元素只有我们写的那几个属性。实际上，未书写的属性大多会使用其默认值。
但这里有一个关键点：“默认值”并非唯一来源，有时属性值会通过继承或层叠计算得出。这就是理解 **CSS 属性计算过程** 的重要性。
整个计算过程分为以下 4 个步骤：
1.  确定声明值
2.  处理层叠冲突
3.  使用继承
4.  使用默认值

## 1. 确定声明值

第一步是找出作者直接声明的样式（作者样式表）和浏览器默认的样式（用户代理样式表）。
例如，对于：

```css
p {
    color: red;
}
```

我们声明了 `p` 元素的颜色为红色。同时，浏览器（用户代理样式表）也为 `p` 设置了 `display`、`margin` 等属性的默认值。如果这些声明之间没有冲突，它们就会被直接采用。

## 2. 层叠冲突

当不同来源的样式规则对同一属性作出不同声明时，就会产生冲突。解决冲突需要依次经过以下三个层次比较：

### 2.1 比较源的重要性

样式表的来源优先级从高到低依次为：
1.  **页面作者样式** (你写的 CSS)
2.  **用户样式** (浏览器用户自定义的样式)
3.  **用户代理样式** (浏览器默认样式)

当冲突发生时，优先级高的来源胜出。

### 2.2 比较优先级（选择器权重）

如果冲突发生在同一来源内（比如都是作者样式），则需比较选择器的权重。通常规则是：`内联样式 > ID选择器 > 类/属性/伪类选择器 > 元素/伪元素选择器`。权重高的样式生效。

### 2.3 比较次序

如果连选择器权重都相同，那么**最后声明的样式**会覆盖之前的样式。
经过以上三步，所有样式声明冲突都能被解决。

## 3. 使用继承

对于那些没有直接声明的属性，浏览器会尝试**继承**。如果一个属性是可继承的（如 `color`, `font-family`），且元素自身未设置，则会从其父元素获取该属性的值。

**注意两点：**

1.  继承是从**最近的父元素**开始，与选择器权重无关。
2.  并非所有属性都可继承（如 `width`, `margin` 就不行）。具体可查阅 MDN 等文档。

## 4. 使用默认值

如果某个属性既没有直接声明（步骤 1），也无法通过继承获得（步骤 3），那么浏览器最终会使用该属性的**初始默认值**。每个 CSS 属性都有其规范定义的初始值。
至此，一个元素的所有 CSS 属性值都确定了。
